# Quest01-review

## Outline

### > 참고자료

- [브라우저 동작 원리](https://www.slideshare.net/JinKyoungHeo/1-2-53043752)
- [[브라우저엔진] 브라우저 렌더링 엔진](https://12bme.tistory.com/208)
- [브라우저는 어떻게 동작하는가?](https://d2.naver.com/helloworld/59361)
- [둘로 나뉜 웹 표준, 하나로 합쳐진다](https://www.zdnet.co.kr/view/?no=20190531184644)



### > 주안점을 둔 부분

- 브라우저 렌더링 엔진 동작 방식의 차이점
  - 기본적인 엔진의 동작 방식부터 어떤 종류의 엔진이 있고, 어떤 차이점이 있는지 알아보았습니다
- 현재 표준 제정 과정과 방향
  - 생각보다 이 과정이 비즈니스적인 싸움의 면모도 보이는 것 같아, W3C와 WHATWG 사이의 이해관계를 더 자세하게 알아보았습니다

---



## 브라우저의 렌더링 엔진

브라우저의 기본 구성 요소는 아래와 같습니다.

- 사용자 인터페이스: 브라우저를 열었을 때 상단에 보이는 여러가지 메뉴나 주소 표시줄 등
- 브라우저 엔진: 사용자 인터페이스와 렌더링 엔진 사이의 동작을 처리
- 렌더링 엔진: 브라우저는 HTTP 모듈이나 파일시스템으로 전달 받은 리소스를 자체 렌더링 엔진을 통해 화면을 그림
- 통신: 네트워크 호출에 사용하는 요소
- 자바스크립트 해석기: V8 같이 자바스크립트 코드를 해석하고 실행하는 역할
- UI 백엔드: 셀렉트, 체크, 인풋 박스 같은 위젯을 그리는데 도움을 줌
- 자료 저장소: 이름 그대로 자료를 저장, HTML5 명세에 로컬 스토리지 등 브라우저가 지원하는 웹 데이터베이스에 대해 정의

이 중 요청 받은 내용을 브라우저 화면에 표시하는 **렌더링 엔진**을 중심으로 알아보겠습니다.

전체적인 과정은 `DOM 트리 구축을 위한 HTML 파싱 - Render tree 구성 - Render tree 레이아웃 - Render tree 그리기`의 과정을 거쳐 화면에 만들어냅니다.

여러 개의 렌더링 엔진이 있고, 브라우저마다 각각의 렌더링 엔진을 탑재하고 있습니다. 현재 주요하게 사용하는 렌더링 엔진은 `Webkit`, `Gecko`, `Blink` 세 가지로 나눌 수 있습니다.

먼저 `Webkit`은 애플이 오픈소스로 개발하고 있는 웹 렌더링 엔진입니다. 애플의 브라우저인 사파리에서 사용하고 있고, 파이어폭스의 iOS 버전도 웹킷을 사용하고 있습니다. 모바일 브라우저에서 많이 사용되는 편인데, 이 부분은 애플이 초기 모바일 시장에 굉장히 큰 영향을 끼친 것이 강하게 작용하지 않았나 생각합니다. 크롬 브라우저도 기존에는 Webkit 엔진을 사용하다가 Webkit 기반의 Blink라는 새로운 웹 렌더링 엔진을 적용하게 되었습니다.

Webkit은 단순히 레이아웃을 그리는 것 외에 여러 가지 개념을 포함합니다. HTML이나 SVG를 위한 레이아웃, DOM 라이브러리인 Webcore, JavaScriptCore, Debugger 등을 포함하고 있기 때문에 좀 더 상위 개념으로 인식합니다. Webkit과 다른 렌더링 엔진들은 처리 과정은 거의 비슷하지만, 다른 엔진에서는 렌더 트리를 형상 트리 라고 부르는 등 사용하는 용어는 약간의 차이가 있습니다.

Webkit2가 설계되면서 UI process를 맡는 부분과 WEB process를 맡는 부분이 분리되게 되었습니다. 그래서 보안이 강화되고 멀티코어 아키텍처를 활용할 수 있는 장점이 있습니다.

`Gecko` 엔진은 넷스케이프에서 만들고 현재는 모질라에서 관리하는 렌더링 엔진입니다. 대표적인 브라우저로 파이어폭스가 있고, 소스 코드가 완전히 공개되어 있어서, 엔진의 개선이 빠른 장점이 있습니다. 확장성이 좋아서 다양한 OS에서 사용이 가능합니다. 위에서 언급한 것처럼 표현하는 용어가 다를뿐 전체적인 과정은 비슷합니다. 모질라에서 관리해서 그런지 모질라에서 개발한 유저 인터페이스 언어인 XUL 기반의 애플리케이션 UI를 해석할 수 있습니다

Gecko의 경우 Webkit과 다르게 DOM 트리와 Style을 연결하는 과정을 HTML 파싱 이후에 수행합니다. Webkit의 경우는 Style 규칙까지 정해진 후에 Attachment라는 이름으로 형성된 DOM 트리와 Style을 연결하게 됩니다.

`Blink`는 Webkit 기반의 렌더링 엔진입니다. 구글 크롬을 비롯한 국내의 웨일, 삼성, 오페라 등에서 사용하고 있습니다. 구글 크롬이 기존에 사용하던 웹킷 엔진과 크롬팀의 방향성이 맞지 않는다는 이유로 개발하기 시작했습니다. 크롬의 다중처리 아키텍처가 다른 웹킷 기반의 브라우저와는 다르고, 웹킷의 아키텍처를 전부 유지하면서 혁신하는 게 어렵다는 이유였습니다. 이를 바탕으로 웹 애플리케이션 속도가 가능한 빨라지도록 하는 게 크롬 팀의 목표입니다.

보안 메커니즘인 sandboxing과 멀티 프로세스 모델이 기존과는 다르게 구현되어 있습니다. 이런 변화는 당장에는 약간 더 브라우저를 무겁게 만들었지, 새로운 기능을 추가하는 등의 요소에서 좀 더 유연성을 갖게 되었습니다.

이 외에도 여러가지 브라우저 엔진이 있는데, 그래도 대표적인게 MS의 `Trident`와 오페라의 `Presto` 입니다.

`Trident`는 IE가 채용하고 있는 렌더링 엔진입니다. 엔진 자체가 모듈방식이기 때문에, 다른 개발자가 자신들의 애플리케이션에 쉽게 웹 브라우저 기능을 추가할 수 있었습니다. MS의 시장 독점과 함께, 오랫동안 업데이트 되지 않았던 적이 있는데, 이로인해 최적화나 표준과의 호환성 문제에서 뒤떨어지고 여러 버그가 누적되는 문제가 있었습니다. 이후 IE7부터 엔진을 개선하기 시작했지만 큰 변화를 얻어내지는 못했고 시장에서 도태되었습니다.

`Presto`는 오페라에서 개발한 렌더링 엔진입니다. 가장 큰 특징은 타 엔진의 1/3 밖에 되지않는 렌더링 속도이지만, 그 댓가로 호환성이 타 렌더링 엔진 대비 떨어집니다. Presto가 빠른 렌더렝 속도를 보여주는 이유는 동적 코어 때문인데, 이 코어가 상황에 따라 페이지 전부 혹은 일부를 적절하게 해석하여 스크립트를 빠르게 처리합니다. 다만 상업용 엔진이기 때문에 브라우저가 제한되고, 이 부분에서 발전이 더뎠다고 평가받고 있습니다. 현재는 오페라도 Presto를 쓰지 않고 Blink를 사용하고 있습니다.



## HTML 표준 제정과 방향

W3C와 WHATWG는 HTML4.x 이후로 각자의 노선을 가지다 HTML5를 기준으로 하나의 표준을 만들어 갔습니다. 물론 표준에 대한 발표는 개별로 진행했습니다. 그래도 여태까지는 나름대로 협력의 틀을 가지고 공통된 HTML과 DOM 표준을 만들어 왔지만 17-18년부터는 서로 동떨어진 결과물을 내놓았습니다. 그리고 기준이 되는 규격이 별개로 두 개 존재하기 때문에, 혼란을 줄 여지가 항상 존재해왔습니다. 당연히 두 단체 사이의 극명한 대립도 있었고, 2018년 4월에는 DOM 표준 4.1 버전 승인에 WHATWG가 뚜렷하게 반대하는 경우도 생겼습니다. 그리고 아무리 어떤 표준을 정한다한들 브라우저가 해당 규격을 구현해주지 않으면 표준의 의미가 없어지기 때문에, 서로의 합의가 중요시되는 상황이었습니다.

이런 상황은 두 단체의 성격과 관련이 있습니다. W3C는 웹기술을 활용하는 표준기군과 기술 전문가들의 모임입니다. 웹의 명확한 표준을 바탕으로 한 안전성이 최우선입니다. 그래서 XHTML 같은 엄격한 규칙을 가진 마크업 표준을 만들고 싶어했습니다. 반면에 WHATWG는 브라우저 시장을 대표하는 공룡 기업들의 모임입니다. 이들의 발전 방향은 비즈니스적인 측면과 강하게 엮여있기 때문에 발전 속도와 실용성이 중요했습니다.

2019년부터 웹 표준이 하나로 합쳐졌습니다. HTML과 DOM 규격 단일 버전을 함께 개발하고, WHATWG에서 발표하는 형태입니다. 서로간의 형식적인 조약 조항은 있습니다. 하지만 표준을 발표하는 주체가 브라우저 회사 집단인 WHATWG이 됐다는 점은, 앞으로 표준이 결정되는 방향에서 브라우저의 이익을 대변하는 결정이 많아질 수도 있다는 점을 시사한다고 생각합니다. 만약 특정 브라우저가 절대적인 점유율을 차지하는 상황이 온다면,  예전에 IE가 독점했던 것과 비슷한 상황이 올 수 있을 것 같습니다.

